<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<plugin>


   <extension
         point="org.eclipse.ui.perspectives">
      <perspective
            class="gama.ui.experiment.perspective.SimulationPerspective"
            fixed="false"
            icon="platform:/plugin/gama.ui.shared/icons/views/perspective.simulation.png"
            id="gama.ui.application.perspectives.SimulationPerspective"
            name="Simulation">
         <description>
            The base perspective definition for simulation perspectives
         </description>
      </perspective>
   </extension>
   <extension
         point="org.eclipse.ui.perspectiveExtensions">
      <perspectiveExtension
            targetID="gama.ui.application.perspectives.SimulationPerspective">
         <viewShortcut
               id="gama.ui.application.view.ConsoleView">
         </viewShortcut>
         <viewShortcut
               id="gama.ui.application.view.ErrorView">
         </viewShortcut>
         <viewShortcut
               id="gama.ui.application.view.ParameterView">
         </viewShortcut>
      </perspectiveExtension>
   </extension>
   <extension
         point="org.eclipse.ui.views">
      <view
            allowMultiple="false"
            category="gama.ui.category.gama"
            class="gama.ui.experiment.views.console.ConsoleView"
            icon="platform:/plugin/gama.ui.shared/icons/views/tabs/view.console.png"
            id="gama.ui.application.view.ConsoleView"
            name="Console"
            restorable="false">
      </view>
      <view
            allowMultiple="true"
            category="gama.ui.category.gama" 
            class="gama.ui.experiment.views.inspectors.PopulationInspectView"
            icon="platform:/plugin/gama.ui.shared/icons/views/tabs/view.browser.png"
            id="gama.ui.application.view.TableAgentInspectView"
            name="Browser" 
            restorable="false">
      </view>
      <view
            allowMultiple="true"
            category="gama.ui.category.gama"
            class="gama.ui.experiment.views.inspectors.AgentInspectView"
            icon="platform:/plugin/gama.ui.shared/icons/views/tabs/view.inspector.png"
            id="gama.ui.application.view.AgentInspectView"
            name="Inspector"
            restorable="false">
      </view>
      <view
            allowMultiple="false"
            category="gama.ui.category.gama"
            class="gama.ui.experiment.views.inspectors.MonitorView"
            icon="platform:/plugin/gama.ui.shared/icons/views/tabs/view.monitors.png"
            id="gama.ui.application.view.MonitorView"
            name="Monitors"
            restorable="false">
      </view>
      <view
            allowMultiple="false"
            category="gama.ui.category.gama"
            class="gama.ui.experiment.views.inspectors.ExperimentParametersView"
            icon="platform:/plugin/gama.ui.shared/icons/views/tabs/view.parameters.png"
            id="gama.ui.application.view.ParameterView"
            name="Parameters"
            restorable="false">
      </view>
      <view
            allowMultiple="false"
            category="gama.ui.category.gama"
            class="gama.ui.experiment.views.ErrorView"
            icon="platform:/plugin/gama.ui.shared/icons/views/tabs/view.errors.png"
            id="gama.ui.application.view.ErrorView"
            name="Errors"
            restorable="false">
      </view>
      <view
            category="gama.ui.category.gama"
            class="gama.ui.experiment.views.user.UserControlView"
            fastViewWidthRatio="0.2"
            icon="platform:/plugin/gama.ui.shared/icons/views/tabs/view.panel.png"
            id="gama.ui.application.view.userControlView"
            name="User Control"
            restorable="false"> 
      </view>
   </extension>
   <extension
         point="org.eclipse.ui.menus">
      <menuContribution
            locationURI="menu:org.eclipse.ui.main.menu">
         <menu
               id="simulationMenu"
               label="Experiment">
            <visibleWhen
                  checkEnabled="false">
               <reference
                     definitionId="isSimulationReady">
               </reference>
            </visibleWhen>
            <command
                  commandId="gama.application.commands.PlaySimulation"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.run_disabled.png"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.run.png"
                  label="Run Experiment"
                  style="push">
               <visibleWhen
                     checkEnabled="false">
                  <reference
                        definitionId="isSimulationPaused">
                  </reference>
               </visibleWhen>
            </command>
            <command
                  commandId="gama.application.commands.PauseSimulation"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.pause.png"
                   disabledIcon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.pause_disabled.png"
                  label="Pause Experiment"
                  mnemonic="M1+P"
                  style="push">
               <visibleWhen
                     checkEnabled="false">
                  <reference
                        definitionId="isSimulationRunning">
                  </reference> 
               </visibleWhen>
            </command>
            <command
                  commandId="gama.application.commands.StepByStepSimulation"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.step_disabled.png"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.step.png"
                  label="Step Experiment"
                  style="push"
                  tooltip="Advance the experiment step by step">
               <visibleWhen
                     checkEnabled="false">
                  <reference
                        definitionId="isSimulationReady">
                  </reference>
               </visibleWhen>
            </command>
            <command
                  commandId="gama.application.commands.StepBackSimulation"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.step.back.png"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.step.back_disabled.png"
                  label="Step Back Experiment"
                  style="push"
                  tooltip="Make One step back in the simulation">
               <visibleWhen
                     checkEnabled="false">
                  <and>
                     <reference
                           definitionId="isSimulationReady">
                     </reference>
                     <reference
                           definitionId="isSimulationMemorize">
                     </reference>
                  </and>
               </visibleWhen>
            </command>
            <separator
                  name="gama.application.separator1"
                  visible="true">
            </separator>
            <command
                  commandId="gama.application.commands.ReloadSimulation"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.reload.png"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.reload_disabled.png"
                  label="Reload Experiment"
                  mnemonic="M1+M2+R"
                  style="push">
            </command>
            <separator
                  name="gama.application.separator2"
                  visible="true">
            </separator>
            <command
                  commandId="gama.application.commands.PauseAndEdit"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/errors.stop.png"
                  label="Stop at First Error"
                  style="toggle">
            </command>
            <command
                  commandId="gama.application.commands.WarningsAsErrors"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/errors.warnings.png"
                  label="Treat Warnings Like Errors"
                  style="toggle">
            </command>
            <command
                  commandId="gama.application.ShowErrors"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/errors.show.png"
                  label="Display Errors and Warnings"
                  style="toggle"> 
            </command>
            <separator
                  name="gama.application.separator3"
                  visible="true">
            </separator>
            <menu
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.simulations.menu.png"
                  id="gama.application.simulations.submenu"
                  label="Simulations...">
               <dynamic
                     class="gama.ui.experiment.menus.SimulationsMenu"
                     id="gama.application.simulations.menu">
               </dynamic>
            </menu>
            <separator
                  name="gama.ui.experiment.separator12"
                  visible="true">
            </separator>
            <command
                  commandId="gama.application.commands.Cancel"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.stop_disabled.png"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.stop.png"
                  label="Close Experiment"
                  style="push"
                  tooltip="Stops the current experiment and dispose of it.">
               <visibleWhen
                     checkEnabled="false">
                  <and>
                     <reference
                           definitionId="isInSimulationPerspective">
                     </reference>
                     <reference
                           definitionId="isSimulationExisting">
                     </reference>
                  </and>
               </visibleWhen>
            </command>
         </menu>
         <menu
               label="Agents">
            <dynamic
                  class="gama.ui.experiment.menus.AgentsMenu"
                  id="gama.application.agents.menu">
            </dynamic>
            <visibleWhen
                  checkEnabled="false">
               <reference
                     definitionId="isSimulationReady">
               </reference>
            </visibleWhen>
         </menu>
         <menu
               id="viewMenu"
               label="Views">
            <menu
                  icon="platform:/plugin/gama.ui.shared/icons/prefs/prefs.ui2.png"
                  id="windowMenu"
                  label="Window">
               <command
                     commandId="org.eclipse.ui.cocoa.minimizeWindow"
                     label="Minimize Window"
                     style="push">
               </command>
               <command
                     commandId="org.eclipse.ui.cocoa.zoomWindow"
                     label="Zoom Window"
                     style="push">
               </command>
               <command
                     commandId="org.eclipse.ui.window.fullscreenmode"
                     label="Toggle Full Screen"
                     style="push">
               </command>
               <command
                     commandId="org.eclipse.ui.cocoa.arrangeWindowsInFront"
                     label="Bring All to Front"
                     style="push">
               </command>
               <visibleWhen
                     checkEnabled="false">
                  <systemTest
                        property="osgi.os"
                        value="macosx">
                  </systemTest>
               </visibleWhen>
            </menu>
            <menu
                  icon="platform:/plugin/gama.ui.shared/icons/prefs/prefs.editor2.png"
                  id="editorsMenu"
                  label="Editor">
               <command
                     commandId="org.eclipse.ui.window.splitEditor"
                     disabledIcon="platform:/plugin/gama.ui.shared/icons/views/layout.vertical_disabled.png"
                     icon="platform:/plugin/gama.ui.shared/icons/views/layout.vertical.png"
                     label="Split Vertically"
                     style="push">
                  <parameter
                        name="Splitter.isHorizontal"
                        value="true">
                  </parameter>
               </command>
               <command
                     commandId="org.eclipse.ui.window.splitEditor"
                     disabledIcon="platform:/plugin/gama.ui.shared/icons/views/layout.horizontal_disabled.png"
                     icon="platform:/plugin/gama.ui.shared/icons/views/layout.horizontal.png"
                     label="Split Horizontally"
                     style="push">
                  <parameter
                        name="Splitter.isHorizontal"
                        value="false">
                  </parameter>
               </command>
               <command
                     commandId="org.eclipse.ui.window.newEditor"
                     disabledIcon="platform:/plugin/gama.ui.shared/icons/views/layout.stack_disabled.png"
                     icon="platform:/plugin/gama.ui.shared/icons/views/layout.stack.png"
                     label="Clone"
                     style="push">
               </command>
               <separator
                     name="gama.ui.experiment.separator1"
                     visible="true">
               </separator>
               <command
                     commandId="org.eclipse.ui.edit.text.zoomIn"
                     disabledIcon="platform:/plugin/gama.ui.shared/icons/display/zoom.in_disabled.png"
                     icon="platform:/plugin/gama.ui.shared/icons/display/zoom.in.png"
                     label="Zoom In"
                     mnemonic="%command.zoomIn.mnemonic"
                     style="push">
                  <visibleWhen
                        checkEnabled="true">
                  </visibleWhen>
               </command>
               <command
                     commandId="org.eclipse.ui.edit.text.zoomOut"
                     disabledIcon="platform:/plugin/gama.ui.shared/icons/display/zoom.out_disabled.png"
                     icon="platform:/plugin/gama.ui.shared/icons/display/zoom.out.png"
                     label="Zoom Out"
                     mnemonic="%command.zoomOut.mnemonic"
                     style="push">
                  <visibleWhen
                        checkEnabled="true">
                  </visibleWhen>
               </command>
               <visibleWhen
                     checkEnabled="false">
                  <reference
                        definitionId="isGamlEditorOpened">
                  </reference>
               </visibleWhen>
               <separator
                     name="gama.ui.experiment.separator2"
                     visible="true">
               </separator>
            </menu>
            <separator
                  name="gama.application.separator6"
                  visible="true">
            </separator>
            <command
                  commandId="gama.application.commands.ShowHideParametersView"
                  icon="platform:/plugin/gama.ui.shared/icons/views/open.parameters.png"
                  label="Parameters"
                  style="push">
               <visibleWhen
                     checkEnabled="false">
                  <reference
                        definitionId="isSimulationReady">
                  </reference>
               </visibleWhen>
            </command>
            <command
                  commandId="gama.application.commands.ShowHideConsoleView"
                  icon="platform:/plugin/gama.ui.shared/icons/views/open.console.png"
                  label="Console"
                  style="push">
               <visibleWhen
                     checkEnabled="false"> 
                  <reference
                        definitionId="isSimulationReady">
                  </reference>
               </visibleWhen>
            </command>
            <command
                  commandId="gama.application.commands.AddMonitor"
                  icon="platform:/plugin/gama.ui.shared/icons/views/open.monitor.png"
                  label="Add Monitor"
                  style="push">
               <visibleWhen
                     checkEnabled="false"> 
                  <reference
                        definitionId="isSimulationReady">
                  </reference>
               </visibleWhen>
            </command>
            <separator
                  name="gama.application.window.views"
                  visible="true">
            </separator>
            <menu
                  icon="platform:/plugin/gama.ui.shared/icons/views/layout.stack.png"
                  label="Manage Outputs...">
               <visibleWhen
                     checkEnabled="false">
                  <reference
                        definitionId="isSimulationReady">
                  </reference>
               </visibleWhen>
               <dynamic
                     class="gama.ui.experiment.menus.OutputsMenu"
                     id="gama.ui.experiment.outputs.menu">
               </dynamic>
            </menu>
            <menu
                  icon="platform:/plugin/gama.ui.shared/icons/views/layout.menu.png"
                  label="Layout Displays... (Experimental)">
               <command
                     commandId="gama.application.layoutDisplays"
                     icon="platform:/plugin/gama.ui.shared/icons/views/layout.stack.png"
                     label="Stacked"
                     style="push">
                  <parameter
                        name="gama.displays.layout"
                        value="Stacked">
                  </parameter>
               </command>
               <command
                     commandId="gama.application.layoutDisplays"
                     icon="platform:/plugin/gama.ui.shared/icons/views/layout.grid.png"
                     label="Split"
                     style="push">
                  <parameter
                        name="gama.displays.layout"
                        value="Split">
                  </parameter>
               </command>
               <command
                     commandId="gama.application.layoutDisplays"
                     icon="platform:/plugin/gama.ui.shared/icons/views/layout.horizontal.png"
                     label="Horizontally"
                     style="push">
                  <parameter
                        name="gama.displays.layout"
                        value="Horizontal">
                  </parameter>
               </command>
               <command
                     commandId="gama.application.layoutDisplays"
                     icon="platform:/plugin/gama.ui.shared/icons/views/layout.vertical.png"
                     label="Vertically"
                     style="push">
                  <parameter
                        name="gama.displays.layout"
                        value="Vertical">
                  </parameter>
               </command>
               <visibleWhen
                     checkEnabled="false">
                  <and>
                     <reference
                           definitionId="isSimulationReady">
                     </reference>
                     <reference
                           definitionId="isInSimulationPerspective">
                     </reference>
                  </and>
               </visibleWhen>
               <separator
                     name="gama.application.separator3"
                     visible="true">
               </separator>
               <command
                     commandId="gama.application.toggleDisplayTabs"
                     label="Toggle Tabs"
                     style="push">
               </command>
               <command
                     commandId="gama.ui.experiment.copyLayout"
                     label="Copy Layout to Clipboard"
                     style="push">
               </command>
            </menu>
            <separator
                  name="gama.application.window.perspectives"
                  visible="true">
            </separator>
            <command
                  commandId="gama.application.goto.simulation"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/views/perspective.simulation_disabled.png"
                  icon="platform:/plugin/gama.ui.shared/icons/views/perspective.simulation.png"
                  label="Switch to Simulation Perspective"
                  style="push"
                  tooltip="Open simulation perspective">
               <visibleWhen
                     checkEnabled="false">
                  <not>
                     <reference
                           definitionId="isInSimulationPerspective">
                     </reference>
                  </not>
               </visibleWhen>
            </command>
            <command
                  commandId="gama.application.goto.modeling"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/views/perspective.modeling_disabled.png"
                  icon="platform:/plugin/gama.ui.shared/icons/views/perspective.modeling.png"
                  label="Switch to Modeling Perspective"
                  style="push"
                  tooltip="Open modeling perspective">
               <visibleWhen
                     checkEnabled="false">
                  <not>
                     <reference
                           definitionId="isInModelingPerspective">
                     </reference>
                  </not>
               </visibleWhen>
            </command>
            <command
                  commandId="gama.ui.resetPerspective"
                  icon="platform:/plugin/gama.ui.shared/icons/views/perspective.reset.png"
                  label="Reset Perspective (restart required)..."
                  style="push">
               <visibleWhen
                     checkEnabled="false">
                  <reference
                        definitionId="isInModelingPerspective">
                  </reference>
               </visibleWhen>
            </command>
            <separator
                  name="gama.application.separator4"
                  visible="true">
            </separator>
            <menu
                  icon="platform:/plugin/gama.ui.shared/icons/views/open.view.png"
                  label="Show View...">
               <dynamic
                     class="gama.ui.shared.commands.ShowViewContributionItem"
                     id="gama.application.showView">
               </dynamic>
               <visibleWhen
                     checkEnabled="false">
                  <reference
                        definitionId="isInModelingPerspective">
                  </reference>
               </visibleWhen>
            </menu>
            <separator
                  name="gama.application.separator5"
                  visible="true">
            </separator>
            <command
                  commandId="org.eclipse.ui.ToggleCoolbarAction"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/display/toolbar.regular_disabled.png"
                  icon="platform:/plugin/gama.ui.shared/icons/display/toolbar.regular.png"
                  label="Hide/Show Toolbar"
                  style="push"
                  tooltip="Toggle the main toolbar on and off">
            </command>
            <command
                  commandId="org.eclipse.ui.window.togglestatusbar"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/display/toolbar.fullscreen_disabled.png"
                  icon="platform:/plugin/gama.ui.shared/icons/display/toolbar.fullscreen.png"
                  label="Hide/Show Status Bar"
                  style="push">
            </command>
            <command
                  commandId="gama.ui.hideShowEditors"
                  icon="platform:/plugin/gama.ui.shared/icons/views/perspective.save.png"
                  label="Hide/Show Editor Area"
                  style="push"
                  tooltip="Hide or show the editors">
            </command>
         </menu>
      </menuContribution>
      <menuContribution
            locationURI="toolbar:gama.application.common.toolbar?after=gama.application.goto.modeling">
            <command
                  commandId="gama.application.goto.simulation"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/views/perspective.simulation_disabled.png"
                  icon="platform:/plugin/gama.ui.shared/icons/views/perspective.simulation.png"
                  label="Simulation perspective"
                  style="push"
                  tooltip="Open simulation perspective">
               <visibleWhen
                     checkEnabled="false">
                  <and>
                     <reference
                           definitionId="isInModelingPerspective">
                     </reference>
                  </and>
               </visibleWhen>
            </command>
            <command
                  commandId="gama.ui.experiment.dummy"
                  icon="platform:/plugin/gama.ui.shared/icons/spacer.png" 
                  style="push"
                  tooltip="  ">
            </command>
            <control
                  class="gama.ui.experiment.controls.ExperimentControlContribution"
                  id="gama.application.status">
            </control>
            <command
                  commandId="gama.ui.experiment.dummy"
                  icon="platform:/plugin/gama.ui.shared/icons/spacer.png"
                  style="push"
                  tooltip="  "> 
            </command>
            <command
                  commandId="gama.application.commands.StepBackSimulation"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.step.back_disabled.png"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.step.back.png"
                  label="Step Back"
                  style="push"
                  tooltip="Make One step back in the simulation">
               <visibleWhen
                     checkEnabled="false">
                  <and>
                     <reference
                           definitionId="isSimulationReady">
                     </reference>
                     <reference
                           definitionId="isSimulationMemorize">
                     </reference>
                  </and>
               </visibleWhen>
            </command>
            <command
                  commandId="gama.application.commands.PlaySimulation"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.run.png"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.run_disabled.png"
                  label="Run Experiment"
                  style="push"
                  tooltip="Run the currently opened experiment">
               <visibleWhen
                     checkEnabled="false">
                  <reference
                        definitionId="isSimulationPaused">
                  </reference>
               </visibleWhen>
            </command>
            <command
                  commandId="gama.application.commands.PauseSimulation"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.pause_disabled.png"
                     icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.pause.png"
                  label="Pause Experiment"
                  style="push"
                  tooltip="Pause the currently opened experiment">
               <visibleWhen
                     checkEnabled="false">
                  <reference
                        definitionId="isSimulationRunning">
                  </reference>
               </visibleWhen>
            </command>
            <command
                  commandId="gama.application.commands.StepByStepSimulation"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.step_disabled.png"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.step.png"
                  label="Step Experiment"
                  style="push"
                  tooltip="Advance the experiment step by step">
               <visibleWhen
                     checkEnabled="false">
                  <reference
                        definitionId="isSimulationReady">
                  </reference>
               </visibleWhen>
            </command>
            <control
                  class="gama.ui.experiment.controls.SimulationSpeedContributionItem"
                  id="gama.application.speed">
               <visibleWhen
                     checkEnabled="false">
                  <reference
                        definitionId="isSimulationReady">
                  </reference>
               </visibleWhen>
            </control>
            <command
                  commandId="gama.application.commands.SynchronizeExperiment"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.sync.png"
                  label="Synchronize Experiment"
                  style="toggle">
               <visibleWhen
                     checkEnabled="false">
                  <and>
                     <reference
                           definitionId="isInSimulationPerspective">
                     </reference>
                     <reference
                           definitionId="isSimulationExisting">
                     </reference>
                  </and>
               </visibleWhen>
            </command>
            <command
                  commandId="gama.application.commands.ReloadSimulation"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.reload.png"
                  label="Reload Experiment"
                  mnemonic="M1+M2+R"
                  style="push">
               <visibleWhen
                     checkEnabled="false">
                  <and>
                     <reference
                           definitionId="isInSimulationPerspective">
                     </reference>
                     <reference
                           definitionId="isSimulationExisting">
                     </reference>
                  </and>
               </visibleWhen>
            </command>
            <command
                  commandId="gama.application.commands.Cancel"
                  disabledIcon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.stop_disabled.png"
                  icon="platform:/plugin/gama.ui.shared/icons/experiment/experiment.stop.png"
                  label="Close Experiment"
                  style="push"
                  tooltip="Stops the currently opened experiment and closes its perspective">
               <visibleWhen
                     checkEnabled="false">
                  <and>
                     <reference
                           definitionId="isInSimulationPerspective">
                     </reference>
                     <reference
                           definitionId="isSimulationExisting">
                     </reference>
                  </and>
               </visibleWhen>
            </command>
            <control
                  class="gama.ui.shared.controls.Separator"
                  id="separator2876">
            </control>
      </menuContribution>
   </extension>
   <extension
         point="org.eclipse.ui.handlers">
      <handler
            class="gama.ui.experiment.commands.StepBackHandler"
            commandId="gama.application.commands.StepBackSimulation">
         <activeWhen>
            <with
                  variable="gama.ui.experiment.SimulationStepBack">
               <equals
                     value="CAN_STEP_BACK">
               </equals>
            </with>
         </activeWhen>
         <enabledWhen>
            <with
                  variable="gama.ui.experiment.SimulationStepBack">
               <equals
                     value="CAN_STEP_BACK">
               </equals>
            </with>
         </enabledWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.PlayPauseSimulationHandler"
            commandId="gama.application.commands.PlaySimulation">
         <activeWhen>
            <reference
                  definitionId="isSimulationReady">
            </reference>
         </activeWhen>
         <enabledWhen>
            <reference
                  definitionId="isSimulationReady">
            </reference>
         </enabledWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.StepByStepHandler"
            commandId="gama.application.commands.StepByStepSimulation">
         <activeWhen>
            <and>
               <reference
                     definitionId="isSimulationReady">
               </reference>
               <not>
                  <reference
                        definitionId="isSimulationBatch">
                  </reference>
               </not>
            </and>
         </activeWhen>
         <enabledWhen>
            <and>
               <reference
                     definitionId="isSimulationReady">
               </reference>
               <not>
                  <reference
                        definitionId="isSimulationRunning">
                  </reference>
               </not>
            </and>
         </enabledWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.ReloadSimulationHandler"
            commandId="gama.application.commands.ReloadSimulation">
         <activeWhen>
            <reference
                  definitionId="isSimulationReady">
            </reference>
         </activeWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.AddMonitorHandler"
            commandId="gama.application.commands.AddMonitor">
         <activeWhen>
            <reference
                  definitionId="isSimulationReady">
            </reference>
         </activeWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.ShowHideParametersViewHandler"
            commandId="gama.application.commands.ShowHideParametersView">
         <activeWhen>
            <reference
                  definitionId="isSimulationReady">
            </reference>
         </activeWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.ShowHideConsoleViewHandler"
            commandId="gama.application.commands.ShowHideConsoleView">
         <activeWhen>
            <reference
                  definitionId="isSimulationReady">
            </reference>
         </activeWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.CancelRun"
            commandId="gama.application.commands.Cancel">
         <activeWhen>
            <reference
                  definitionId="isInSimulationPerspective">
            </reference>
         </activeWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.ErrorsPauseAndEdit"
            commandId="gama.application.commands.PauseAndEdit">
      </handler>
      <handler
            class="gama.ui.experiment.commands.TreatWarningsAsErrors"
            commandId="gama.application.commands.WarningsAsErrors">
      </handler>
      <handler
            class="gama.ui.experiment.commands.ShowErrors"
            commandId="gama.application.ShowErrors">
      </handler>
      <handler
            class="gama.ui.shared.commands.SwitchToModeling"
            commandId="gama.application.goto.modeling">
         <activeWhen>
            <or>
               <reference
                     definitionId="isSimulationReady">
               </reference>
               <reference
                     definitionId="isSimulationFinished">
               </reference>
            </or>
         </activeWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.ToggleDisplayTabs"
            commandId="gama.application.toggleDisplayTabs">
         <activeWhen>
            <and>
               <reference
                     definitionId="isInSimulationPerspective">
               </reference>
               <reference
                     definitionId="isSimulationReady">
               </reference>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.ArrangeDisplayViews"
            commandId="gama.application.layoutDisplays">
         <activeWhen>
            <and>
               <reference
                     definitionId="isInSimulationPerspective">
               </reference>
               <reference
                     definitionId="isSimulationReady">
               </reference>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="gama.ui.shared.commands.SwitchToSimulation"
            commandId="gama.application.goto.simulation">
         <activeWhen>
            <and>
               <reference
                     definitionId="isInModelingPerspective">
               </reference>
               <not>
                  <with
                        variable="gama.ui.experiment.SimulationRunningState">
                     <equals
                           value="NONE">
                     </equals>
                  </with>
               </not>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.CopyLayout"
            commandId="gama.ui.experiment.copyLayout">
         <activeWhen>
            <and>
               <reference
                     definitionId="isInSimulationPerspective">
               </reference>
               <reference
                     definitionId="isSimulationReady">
               </reference>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.ResetModelingPerspective"
            commandId="gama.ui.resetPerspective">
         <activeWhen>
            <reference
                  definitionId="isInModelingPerspective">
            </reference>
         </activeWhen>
         <enabledWhen>
            <reference
                  definitionId="isInModelingPerspective">
            </reference>
         </enabledWhen>
      </handler>
      <handler
            class="gama.ui.experiment.commands.SynchronizeExperimentHandler"
            commandId="gama.application.commands.SynchronizeExperiment">
         <activeWhen>
            <reference
                  definitionId="isSimulationReady">
            </reference>
         </activeWhen>
         <enabledWhen>
            <reference
                  definitionId="isSimulationReady">
            </reference>
         </enabledWhen>
      </handler>
   </extension>
   <extension
         point="org.eclipse.ui.contexts">
      <context
            id="gama.application.simulation.context"
            name="In Experiments"
            parentId="org.eclipse.ui.contexts.dialogAndWindow">
      </context>
   </extension>
   <extension
         point="org.eclipse.core.expressions.definitions">
      <definition
            id="isSimulationReady">
         <and>
            <reference
                  definitionId="isInSimulationPerspective">
            </reference>
            <or>
               <with
                     variable="gama.ui.experiment.SimulationRunningState">
                  <equals
                        value="RUNNING">
                  </equals>
               </with>
               <with
                     variable="gama.ui.experiment.SimulationRunningState">
                  <equals
                        value="PAUSED">
                  </equals>
               </with>
            </or>
         </and>
      </definition>
      <definition
            id="isSimulationRunning">
         <and>
            <reference
                  definitionId="isInSimulationPerspective">
            </reference>
            <with
                  variable="gama.ui.experiment.SimulationRunningState">
               <equals
                     value="RUNNING">
               </equals>
            </with>
         </and>
      </definition>
      <definition
            id="isSimulationPaused">
         <and>
            <reference
                  definitionId="isInSimulationPerspective">
            </reference>
            <with
                  variable="gama.ui.experiment.SimulationRunningState">
               <equals
                     value="PAUSED">
               </equals>
            </with>
         </and>
      </definition>
      <definition
            id="isSimulationExisting">
         <and>
            <reference
                  definitionId="isInSimulationPerspective">
            </reference>
            <not>
               <with
                     variable="gama.ui.experiment.SimulationRunningState">
                  <equals
                        value="NONE">
                  </equals>
               </with>
            </not>
         </and>
      </definition>
      <definition
            id="isGamlEditorOpened">
         <and>
            <reference
                  definitionId="isActiveEditorAnInstanceOfXtextEditor">
            </reference>
            <with
                  variable="activeEditor">
               <test
                     forcePluginActivation="true"
                     property="org.eclipse.xtext.ui.editor.XtextEditor.languageName"
                     value="gaml.compiler.Gaml">
               </test>
            </with>
         </and>
      </definition>
      <definition
            id="isSimulationBatch">
         <and>
            <reference
                  definitionId="isInSimulationPerspective">
            </reference>
            <with
                  variable="gama.ui.experiment.SimulationType">
               <equals
                     value="BATCH">
               </equals>
            </with>
         </and>
      </definition>
      <definition
            id="isSimulationMemorize">
         <and>
            <reference
                  definitionId="isInSimulationPerspective">
            </reference>
            <with
                  variable="gama.ui.experiment.SimulationType">
               <equals
                     value="RECORD">
               </equals>
            </with>
         </and>
      </definition>
      <definition
            id="isInModelingPerspective">
         <with
               variable="activeWorkbenchWindow.activePerspective">
            <equals
                  value="gama.ui.application.perspectives.ModelingPerspective">
            </equals>
         </with>
      </definition>
      <definition
            id="isInSimulationPerspective">
         <with
               variable="activeWorkbenchWindow.activePerspective">
            <test
                  property="gama.ui.containsString"
                  value="Simulation">
            </test>
         </with>
      </definition>
      <definition
            id="isSimulationFinished">
         <and>
            <reference
                  definitionId="isInSimulationPerspective">
            </reference>
            <with
                  variable="gama.ui.experiment.SimulationRunningState">
               <equals
                     value="FINISHED">
               </equals>
            </with>
         </and>
      </definition>
   </extension>
   <extension
         point="org.eclipse.ui.commands">
      <command
            categoryId="gama.category"
            defaultHandler="gama.ui.experiment.commands.PlayPauseSimulationHandler"
            id="gama.application.commands.PlaySimulation"
            name="Play Experiment">
      </command>
      <command
            categoryId="gama.category"
            defaultHandler="gama.ui.experiment.commands.PlayPauseSimulationHandler"
            id="gama.application.commands.PauseSimulation"
            name="Pause Simulation">
      </command>
      <command
            categoryId="gama.category"
            id="gama.application.commands.StepByStepSimulation"
            name="Next Step">
      </command>
      <command
            categoryId="gama.category"
            id="gama.application.commands.StepBackSimulation"
            name="Previous Step ">
      </command>
      <command
            categoryId="gama.category"
            defaultHandler="gama.ui.experiment.commands.ReloadSimulationHandler"
            id="gama.application.commands.ReloadSimulation"
            name="Reload Simulation">
      </command>
      <command
            categoryId="gama.category"
            defaultHandler="gama.ui.experiment.commands.ShowHideParametersViewHandler"
            id="gama.application.commands.ShowHideParametersView"
            name="Show parameters">
      </command>
      <command
            categoryId="gama.category"
            id="gama.application.commands.AddMonitor"
            name="Add a monitor">
      </command>
      <command
            categoryId="gama.category"
            id="gama.application.commands.ShowHideConsoleView"
            name="Show console">
      </command>
      <command
            categoryId="gama.category"
            id="gama.application.commands.Cancel"
            name="Cancel">
      </command>
      <command
            categoryId="gama.category"
            id="gama.application.commands.PauseAndEdit"
            name="Pause at first error">
      </command>
      <command
            categoryId="gama.category"
            id="gama.application.commands.WarningsAsErrors"
            name="Treat warnings like errors">
      </command>
      <command
            categoryId="gama.category"
            id="gama.application.ShowErrors"
            name="Display errors and warnings">
      </command>
      <command
            categoryId="gama.category"
            id="gama.application.goto.modeling"
            name="Switch to modeling perspective">
      </command>
      <command
            categoryId="gama.category"
            id="gama.application.layoutDisplays"
            name="Layout display views">
         <commandParameter
               id="gama.displays.layout"
               name="layout"
               optional="false"
               typeId="gama.application.String">
         </commandParameter>
      </command>
      <command
            categoryId="gama.category"
            id="gama.application.goto.simulation"
            name="Switch to simulation perspective">
      </command>
      <command
            defaultHandler="gama.ui.experiment.commands.DummyHandler"
            id="gama.ui.experiment.dummy"
            name="Separator">
      </command>
      <command
            defaultHandler="gama.ui.experiment.commands.ShowInteractiveConsole"
            id="gama.application.command.interactive"
            name="Show Interactive Console">
      </command>
      <command
            id="gama.application.toggleDisplayTabs"
            name="Toggle Display Tabs">
      </command>
      <command
            id="gama.ui.experiment.copyLayout"
            name="Copy Layout">
      </command>
      <command
            categoryId="gama.category"
            id="gama.ui.resetPerspective"
            name="Reset Perspective...">
      </command>
      <command
            categoryId="gama.category"
            defaultHandler="gama.ui.experiment.commands.SynchronizeExperimentHandler"
            id="gama.application.commands.SynchronizeExperiment"
            name="Synchronize Experiment">
         <state
               class="gama.ui.experiment.commands.SyncExperimentState"
               id="org.eclipse.ui.commands.toggleState">
         </state>
      </command>
      <command
            categoryId="gama.category"
            defaultHandler="gama.ui.experiment.commands.HideShowEditors"
            id="gama.ui.hideShowEditors"
            name="Hide/Show Editors">
      </command>
      <command
            id="gama.ui.experiment.toolbar.simulation.menu"
            name="Simulations">
      </command>
   </extension>
   <extension
         point="org.eclipse.ui.services">
      <serviceFactory
            factoryClass="gama.ui.experiment.factories.AgentMenuFactory">
         <service
               serviceClass="gama.ui.shared.interfaces.IAgentMenuFactory"></service>
      </serviceFactory>
      <serviceFactory
            factoryClass="gama.ui.experiment.factories.UserDialogFactory">
         <service
               serviceClass="gama.ui.shared.interfaces.IUserDialogFactory"></service>
      </serviceFactory>
      <sourceProvider
            provider="gama.ui.experiment.commands.ExperimentStateProvider">
         <variable
               name="gama.ui.experiment.SimulationRunningState"
               priorityLevel="workbench">
         </variable>
         <variable
               name="gama.ui.experiment.SimulationType"
               priorityLevel="workbench">
         </variable>
      </sourceProvider>
      <serviceFactory
            factoryClass="gama.ui.experiment.factories.SpeedDisplayerFactory">
         <service
               serviceClass="gama.ui.shared.interfaces.ISpeedDisplayer">
         </service>
      </serviceFactory>
      <serviceFactory
            factoryClass="gama.ui.experiment.factories.ConsoleDisplayerFactory">
         <service
               serviceClass="gama.core.common.interfaces.IConsoleListener">
         </service>
      </serviceFactory>
      <serviceFactory
            factoryClass="gama.ui.experiment.factories.DisplayLayoutFactory">
         <service
               serviceClass="gama.ui.shared.interfaces.IDisplayLayoutManager">
         </service>
      </serviceFactory>
      <serviceFactory
            factoryClass="gama.ui.experiment.factories.RuntimeExceptionHandlerFactory">
         <service
               serviceClass="gama.core.common.interfaces.IRuntimeExceptionHandler">
         </service>
      </serviceFactory>
   </extension>
   <extension
         point="org.eclipse.core.expressions.propertyTesters">
      <propertyTester
            class="gama.ui.experiment.perspective.PerspectiveNamePropertyTester"
            id="gama.ui.PerspectiveNamePropertyTester"
            namespace="gama.ui"
            properties="containsString"
            type="java.lang.Object">
      </propertyTester>
   </extension>

</plugin>
